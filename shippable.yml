language: node_js

node_js:
  - 10.8

env:
  - XUNIT_FILE=shippable/testresults/result.xml

runtime:
  nodePool: shippable_shared_aarch64

build:
  ci:
    - apt-get update --yes && apt-get install build-essential g++ flex bison gperf ruby perl libsqlite3-dev libfontconfig1-dev libicu-dev libfreetype6 libssl-dev libpng-dev libjpeg-dev python libx11-dev libxext-dev
    - git clone git://github.com/ariya/phantomjs.git
    - cd phantomjs
    - git checkout 2.1.1
    - git submodule init
    - git submodule update
    - ./build.py
    - cp bin/phantomjs /usr/bin/
    - cd ..
    - npm install
    - npm test
  cache: true

  cache_dir_list:
    - $SHIPPABLE_BUILD_DIR/node_modules
